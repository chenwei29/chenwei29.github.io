<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/touxiang.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/touxiang.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/touxiang.jpg">
  <link rel="mask-icon" href="/images/touxiang.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="什么是网络?计算机网络的构成是什么?​    在计算机领域中，网络是信息传输、接收、共享的虚拟平台.通过它把各个点,面,体的信息联系到一起,从而实现对这些资源的共享. 什么是网络编程? 从大的方面来说,就是对信息的发送到接受 通过操作响应的api调度计算机硬件资源,并利用传输管道(例如网线)进行数据交换的过程 更为具体的涉及:网络模型,套接字,数据包">
<meta property="og:type" content="article">
<meta property="og:title" content="Java网络编程初始">
<meta property="og:url" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="什么是网络?计算机网络的构成是什么?​    在计算机领域中，网络是信息传输、接收、共享的虚拟平台.通过它把各个点,面,体的信息联系到一起,从而实现对这些资源的共享. 什么是网络编程? 从大的方面来说,就是对信息的发送到接受 通过操作响应的api调度计算机硬件资源,并利用传输管道(例如网线)进行数据交换的过程 更为具体的涉及:网络模型,套接字,数据包">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210714225437336.png">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210714231119293.png">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715233140805.png">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715214205523.png">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715232631856.png">
<meta property="og:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210718215504449.png">
<meta property="article:published_time" content="2021-07-14T13:40:57.000Z">
<meta property="article:modified_time" content="2021-07-19T07:10:57.673Z">
<meta property="article:author" content="cw">
<meta property="article:tag" content="学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210714225437336.png">

<link rel="canonical" href="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Java网络编程初始 | 博客</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">积跬步，至千里</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E7%BB%9C-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E6%9E%84%E6%88%90%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.</span> <span class="nav-text">什么是网络?计算机网络的构成是什么?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">什么是网络编程?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B-OSI"><span class="nav-number">3.</span> <span class="nav-text">7层网络模型-OSI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="nav-number">3.1.</span> <span class="nav-text">网络模型的对应关系:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket%E4%B8%8ETCP-UDP"><span class="nav-number">4.</span> <span class="nav-text">Socket与TCP,UDP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E4%BC%A0%E8%BE%93"><span class="nav-number">4.1.</span> <span class="nav-text">TCP传输</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E4%BC%A0%E8%BE%93"><span class="nav-number">4.2.</span> <span class="nav-text">UDP传输</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client-Server-Application"><span class="nav-number">5.</span> <span class="nav-text">Client-Server Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket-%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="nav-number">6.</span> <span class="nav-text">Socket 小案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E6%96%87-%E5%8D%8F%E8%AE%AE-Mac%E5%9C%B0%E5%9D%80"><span class="nav-number">7.</span> <span class="nav-text">报文,协议,Mac地址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%A5%E6%96%87"><span class="nav-number">7.1.</span> <span class="nav-text">报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="nav-number">7.2.</span> <span class="nav-text">传输协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mac%E5%9C%B0%E5%9D%80"><span class="nav-number">7.3.</span> <span class="nav-text">Mac地址</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-%E7%AB%AF%E5%8F%A3-%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">8.</span> <span class="nav-text">IP,端口,远程服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IP%E5%9C%B0%E5%9D%80"><span class="nav-number">8.1.</span> <span class="nav-text">IP地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3"><span class="nav-number">8.2.</span> <span class="nav-text">端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">8.3.</span> <span class="nav-text">远程服务器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket-UDP%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-number">9.</span> <span class="nav-text">Socket-UDP快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">9.1.</span> <span class="nav-text">UDP是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E4%BB%80%E4%B9%88%E4%B8%8D%E5%8F%AF%E9%9D%A0"><span class="nav-number">9.2.</span> <span class="nav-text">UDP什么不可靠</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="nav-number">9.3.</span> <span class="nav-text">UDP能做什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E6%A0%B8%E5%BF%83API"><span class="nav-number">9.4.</span> <span class="nav-text">UDP核心API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E5%8D%95%E6%92%AD-%E5%B9%BF%E6%92%AD-%E5%A4%9A%E6%92%AD"><span class="nav-number">9.5.</span> <span class="nav-text">UDP单播,广播,多播</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UDP%E6%A1%88%E4%BE%8B-%E5%B1%80%E5%9F%9F%E7%BD%91%E6%90%9C%E7%B4%A2%E6%A1%88%E4%BE%8B"><span class="nav-number">10.</span> <span class="nav-text">UDP案例-局域网搜索案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP%E5%8F%91%E9%80%81%E4%B8%8E%E7%9B%91%E5%90%AC%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="nav-number">10.1.</span> <span class="nav-text">UDP发送与监听小案例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket-TCP%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-number">11.</span> <span class="nav-text">Socket-TCP快速入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">11.1.</span> <span class="nav-text">TCP是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E9%93%BE%E6%8E%A5-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B"><span class="nav-number">11.2.</span> <span class="nav-text">TCP链接,传输流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="nav-number">11.3.</span> <span class="nav-text">TCP能做什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E6%A0%B8%E5%BF%83API%E8%AE%B2%E8%A7%A3"><span class="nav-number">11.4.</span> <span class="nav-text">TCP核心API讲解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP%E8%BF%9E%E6%8E%A5%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="nav-number">12.</span> <span class="nav-text">TCP连接可靠性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%8F%AF%E9%9D%A0%E6%80%A7%E2%80%93%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="nav-number">12.1.</span> <span class="nav-text">连接可靠性–三次握手</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E5%80%BC%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7"><span class="nav-number">12.2.</span> <span class="nav-text">随机值的必要性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%8F%AF%E9%9D%A0%E6%80%A7%E2%80%93%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="nav-number">12.3.</span> <span class="nav-text">连接可靠性–四次挥手</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="cw"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">cw</p>
  <div class="site-description" itemprop="description">博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="cw">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java网络编程初始
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-14 21:40:57" itemprop="dateCreated datePublished" datetime="2021-07-14T21:40:57+08:00">2021-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-19 15:10:57" itemprop="dateModified" datetime="2021-07-19T15:10:57+08:00">2021-07-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Java基础学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="什么是网络-计算机网络的构成是什么"><a href="#什么是网络-计算机网络的构成是什么" class="headerlink" title="什么是网络?计算机网络的构成是什么?"></a>什么是网络?计算机网络的构成是什么?</h3><p>​    在计算机领域中，网络是信息传输、接收、共享的虚拟平台.通过它把各个点,面,体的信息联系到一起,从而实现对这些资源的共享.</p>
<h3 id="什么是网络编程"><a href="#什么是网络编程" class="headerlink" title="什么是网络编程?"></a>什么是网络编程?</h3><ul>
<li>从大的方面来说,就是对信息的发送到接受</li>
<li>通过操作响应的api调度计算机硬件资源,并利用传输管道(例如网线)进行数据交换的过程</li>
<li>更为具体的涉及:网络模型,套接字,数据包</li>
</ul>
<span id="more"></span>

<h3 id="7层网络模型-OSI"><a href="#7层网络模型-OSI" class="headerlink" title="7层网络模型-OSI"></a>7层网络模型-OSI</h3><p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210714225437336.png" alt="image-20210714225437336"></p>
<ul>
<li>应用层: 应用层是最靠近用户的OSI层。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务。协议有：HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP等。</li>
<li>表示层: 数据的表示、安全、压缩。可确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取。格式有：JPEG、ASCll、DECOIC、加密格式等。</li>
<li>会话层:建立、管理、终止会话，对应主机进程，指本地主机与远程主机正在进行的会话。常见的格式:服务器验证用户的登录,断点续传</li>
<li>传输层: 定义传输数据的协议端口号，以及流控和差错校验。协议有：TCP UDP等，数据包一旦离开网卡即进入网络传输层。</li>
<li>网络层: 进行逻辑地址寻址，实现不同网络之间的路径选择。协议有：ICMP IGMP IP（IPV4 IPV6） ARP RARP等。</li>
<li>数据链路层: 建立逻辑连接、进行硬件地址寻址、差错校验等功能。（由底层网络定义协议）数据链路层协议的代表包括：SDLC、HDLC、PPP、STP、帧中继等。</li>
<li>物理层: 建立、维护、断开物理连接。（由底层网络定义协议）物理层的任务就是为它的上一层提供一个物理连接，以及它们的机械、电气、功能和过程特性。如规定使用电缆和接头的类型、传送信号的电压等。在这一层，数据还没有被组织，仅作为原始的位流或电气电压处理，单位是bit比特。</li>
</ul>
<p>网络模型编程:</p>
<ul>
<li>基础层: 物理层,数据链路层,网络层</li>
<li>传输层: TCP-UDP协议层,Socket (主要是在传输层以上的封装,并不进行传输层面的封装,因为TCP-UDP本身就是传输层的东西,我们的目的就是为了怎样的去用他)</li>
<li>高级层: 会话层,表示层,应用层</li>
</ul>
<h4 id="网络模型的对应关系"><a href="#网络模型的对应关系" class="headerlink" title="网络模型的对应关系:"></a>网络模型的对应关系:</h4><p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210714231119293.png" alt="image-20210714231119293"></p>
<ul>
<li>TCP所封装的技术:telent,FTP,SMTP</li>
<li>UDP所封装的技术:DNS,RIP,SNMP</li>
<li>TCP与UDP中都用到了IP</li>
</ul>
<h3 id="Socket与TCP-UDP"><a href="#Socket与TCP-UDP" class="headerlink" title="Socket与TCP,UDP"></a>Socket与TCP,UDP</h3><ul>
<li>Socket就是对TCP与UDP进行封装.</li>
<li>Socket简单来说就是ip地址与端口的结合协议(RFC 793).</li>
<li>是一个种地址与端口的结合描述协议.</li>
<li>TCP/IP协议的相关API的总称;是网络API的集合实现.</li>
<li>Socket的作用和组成.<ul>
<li>在网络传输中用于唯一标示两个端点的链接.</li>
<li>端点包括IP+port(端口).</li>
<li>四个要素:客户端的地址,客户端的端口,服务端的地址,服务端的端口.</li>
</ul>
</li>
<li>TCP是面向连接的通信协议.</li>
<li>通过三次握手建立连接,通讯完成时要拆除连接.</li>
<li>由于TCP是面向连接的,所以只能用于端到端的通讯(就是在某一时刻,只能面向这一个端口)</li>
<li>UDP是面向无连接的通讯协议.</li>
<li>UDP数据包括目的的端口号和源端口号的信息</li>
<li>由于通讯不需要连接,所以可以实现广播发送,并不局限于端对端</li>
</ul>
<h4 id="TCP传输"><a href="#TCP传输" class="headerlink" title="TCP传输"></a>TCP传输</h4><p>​    一个数据发送到服务器上,是基于TCP数据发送,同时会收到一条TCP的回复,说明已经收到了(回复并不是我们来完成的,而是TCP层面,数据层面已经完成了封装, 当我们发送数据的时候,只有两个状态,要么发送成功,要么发送失败)</p>
<h4 id="UDP传输"><a href="#UDP传输" class="headerlink" title="UDP传输"></a>UDP传输</h4><p>​    UDP只管发送,并不管服务器是否接收到.</p>
<h3 id="Client-Server-Application"><a href="#Client-Server-Application" class="headerlink" title="Client-Server Application"></a>Client-Server Application</h3><ul>
<li>TCP/IP协议中,两个进程间的通信的主要模式为:CS模式(客户端服务端)</li>
<li>主要目的:协同网络中的计算机资源,服务模式,进程间的数据共享</li>
<li>常见的:FTP.SMTP,HTTP</li>
</ul>
<h3 id="Socket-小案例"><a href="#Socket-小案例" class="headerlink" title="Socket 小案例"></a>Socket 小案例</h3><p>在本次案例中:</p>
<ul>
<li>构建TCP客户端,服务端</li>
<li>客户端发送数据</li>
<li>服务器读取数据并打印数据</li>
</ul>
<p>服务端:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">2000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器准备就绪!&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器信息 : &quot;</span> + server.getInetAddress() + <span class="string">&quot;端口号 : &quot;</span> + server.getLocalPort());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//等待客户端连接</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//得到客户端</span></span><br><span class="line">            Socket clientSocket = server.accept();</span><br><span class="line">            <span class="comment">//客户端构建异步线程</span></span><br><span class="line">            ClientHandler clientHandler = <span class="keyword">new</span> ClientHandler(clientSocket);</span><br><span class="line">            clientHandler.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对多个客户端进行异步处理</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientHandler</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Socket socket;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ClientHandler</span><span class="params">(Socket socket)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.socket = socket;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;新客户端连接: &quot;</span> + socket.getInetAddress() + <span class="string">&quot;端口号&quot;</span> + socket.getPort());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//得到输出流,用于输出数据</span></span><br><span class="line">                PrintStream socketOutput = <span class="keyword">new</span> PrintStream(socket.getOutputStream());</span><br><span class="line">                <span class="comment">//服务器的输入流就等于客户端的输出流,得到数据</span></span><br><span class="line">                BufferedReader socketReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    String str = socketReader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;bye&quot;</span>.equals(str)) &#123;</span><br><span class="line">                        flag = <span class="keyword">false</span>;</span><br><span class="line">                        socketOutput.println(<span class="string">&quot;bye&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//打印到控制台,并且回复一句话</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;客户端发来的数据 : &quot;</span> + str);</span><br><span class="line">                    socketOutput.println(str.length() + <span class="string">&quot;,有这么长的话!&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">                socketOutput.close();</span><br><span class="line">                socketReader.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;连接异常断开&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端已经关闭&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Socket socket = new Socket();</span><br><span class="line">        //超时时间</span><br><span class="line">        socket.setSoTimeout(3000);</span><br><span class="line">        //连接本地地址,端口号为2000,超时时间3s</span><br><span class="line">        socket.connect(new InetSocketAddress(Inet4Address.getLocalHost(), 2000), 2000);</span><br><span class="line">        System.out.println(&quot;已向服务器发起连接!等待后续!&quot;);</span><br><span class="line">        System.out.println(&quot;客户端信息 : &quot; + socket.getLocalAddress() + &quot;端口号 : &quot; + socket.getLocalPort());</span><br><span class="line">        System.out.println(&quot;服务器信息 : &quot; + socket.getInetAddress() + &quot;端口号 : &quot; + socket.getPort());</span><br><span class="line">        try &#123;</span><br><span class="line">            //发送数据</span><br><span class="line">            todo(socket);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            System.out.println(&quot;异常关闭!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //释放资源</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(&quot;客户端已经退出!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void todo(Socket client) throws IOException &#123;</span><br><span class="line">        //得到键盘输入流</span><br><span class="line">        InputStream in = System.in;</span><br><span class="line">        //转换为包装字符流</span><br><span class="line">        BufferedReader reader = new BufferedReader(new InputStreamReader(in));</span><br><span class="line"></span><br><span class="line">        //得到Socket输出流</span><br><span class="line">        OutputStream outputStream = client.getOutputStream();</span><br><span class="line">        //转换成打印流</span><br><span class="line">        PrintStream printStream = new PrintStream(outputStream);</span><br><span class="line">        //得到Socket输入流</span><br><span class="line">        InputStream inputStream = client.getInputStream();</span><br><span class="line">        BufferedReader socketReader = new BufferedReader(new InputStreamReader(inputStream));</span><br><span class="line">        boolean flag = true;</span><br><span class="line">        do &#123;</span><br><span class="line">            //键盘读取一行</span><br><span class="line">            String msg = reader.readLine();</span><br><span class="line">            //发送给服务器</span><br><span class="line">            printStream.println(msg);</span><br><span class="line"></span><br><span class="line">            //从服务器获取一行</span><br><span class="line">            String socketMsg = socketReader.readLine();</span><br><span class="line">            if (&quot;bye&quot;.equals(socketMsg)) flag = false;</span><br><span class="line">            else System.out.println(socketMsg);</span><br><span class="line">        &#125; while (flag);</span><br><span class="line">        reader.close();</span><br><span class="line">        printStream.close();</span><br><span class="line">        socketReader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="报文-协议-Mac地址"><a href="#报文-协议-Mac地址" class="headerlink" title="报文,协议,Mac地址"></a>报文,协议,Mac地址</h3><h4 id="报文"><a href="#报文" class="headerlink" title="报文"></a>报文</h4><ul>
<li>报文段是指TCP/IP协议网络传输过程中,起着路由导航作用.</li>
<li>用以查询各个网络路由网段,IP地址,交换协议等IP数据包.</li>
<li>报文段充当整个TCP/IP协议数据包的导航路由功能.</li>
<li>报文在传输过程中会不断的封装成组,包,帧来传输.(当传输一些大数据的时候,会将大数据转换成组或者包,帧解析成一个个小的数据点,通过小的数据点来传输.)</li>
<li>封装的方式就是添加一些控制信息组成的头部,即报文头.</li>
</ul>
<h4 id="传输协议"><a href="#传输协议" class="headerlink" title="传输协议"></a>传输协议</h4><ul>
<li>协议顾名思义,一种规定,约束</li>
<li>约定大于配置,在网络传输中同样也适应;网络传输的流程是健壮的稳定的,得益于基础的协议构成.</li>
<li>简单来说: A-&gt;B的传输数据,B能识别,反之B-&gt;A,A也能识别,这就是协议.</li>
</ul>
<h4 id="Mac地址"><a href="#Mac地址" class="headerlink" title="Mac地址"></a>Mac地址</h4><ul>
<li>Mac地址叫 Media Access Control或者Medium Access Control翻译为谋体访问控制,或为物理地址,硬件地址.</li>
<li>用来定义网络设备的位置</li>
<li>比如11-22-33-44-55-66 11:22:33:44:55:66 类似于身份证</li>
</ul>
<h3 id="IP-端口-远程服务器"><a href="#IP-端口-远程服务器" class="headerlink" title="IP,端口,远程服务器"></a>IP,端口,远程服务器</h3><h4 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h4><ul>
<li>即互联网协议地址 </li>
<li>是分配给网络上使用网际协议的设备的数字标签</li>
<li>常见的IP分为IPv4和IPv6两大类</li>
<li>IP地址由32为二进制数组成,常以xxx.xxx.xxx.xxx形式出现,每组xxx代表小于或等于255的10进制数.</li>
<li>IP地址分为A.B,C,D,E五大类,其中E类为特殊保留地址.</li>
</ul>
<p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715233140805.png" alt="image-20210715233140805"></p>
<ul>
<li>IPv4的数量比较少只有42亿个,已经在2011年分配完了</li>
<li>IP地址-IPv6<ul>
<li>总共有128位长,采用32个16进制</li>
<li>由两个逻辑部分组成:一个64位的网络前缀和一个64位的主机地址，主机地址通常根据物理地址自动生成，叫做EUI-64（或者64-位扩展唯一标识)</li>
</ul>
</li>
<li>lPv4转换为IPv6一定可行，lPv6转换为IPv4不一定可行</li>
</ul>
<h4 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h4><ul>
<li>如果把IP地址比作一间房子，端口就是出入这间房子的门或者窗户</li>
<li>0到1023号端口以及1024到49151号端口都是特殊端口</li>
</ul>
<p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715214205523.png" alt="image-20210715214205523"></p>
<ul>
<li>计算机之间依照互联网传输层TCP/IP协议的协议通信，不同的协议都对应不同的端口</li>
<li>49152到65535号端口属于动态端口范围，没有端口可以被正式地注册占用</li>
<li>电脑的总端口数为65536个,一个IP地址有这么多个.如果你的本机有多个IP,那么也会有很多个.</li>
</ul>
<h4 id="远程服务器"><a href="#远程服务器" class="headerlink" title="远程服务器"></a>远程服务器</h4><ul>
<li>局域网︰一般而言，家里的环境以及公司相互电脑之间环境都属于局域网</li>
<li>我的电脑与我的手机之间属于局域网,我的电脑与陌生人的电脑属于互联网</li>
</ul>
<h3 id="Socket-UDP快速入门"><a href="#Socket-UDP快速入门" class="headerlink" title="Socket-UDP快速入门"></a>Socket-UDP快速入门</h3><h4 id="UDP是什么"><a href="#UDP是什么" class="headerlink" title="UDP是什么"></a>UDP是什么</h4><ul>
<li>是一种用户数据报协议,又称用户数据报文协议</li>
<li>是一个简单的面向数据报的传输层协议，正式规范为RFC 768</li>
<li>是一个用户数据协议,不是连接协议.</li>
</ul>
<h4 id="UDP什么不可靠"><a href="#UDP什么不可靠" class="headerlink" title="UDP什么不可靠"></a>UDP什么不可靠</h4><ul>
<li>它一旦把应用程序发给网络层的数据发送出去,就不保留备份(在UDP的数据层面,它只管发送或者接受数据,不对这个数据进行保留备份重发等等)</li>
<li>UDP在IP数据报的头部仅仅加入了复用和数据校验（字段)</li>
<li>在发送端生产数据,接收端从网络中抓取数据.(所以它们数据发送,是不需要连接的)</li>
<li>结构简单,无校验,速度快,容易丢包,但是可以广播</li>
</ul>
<h4 id="UDP能做什么"><a href="#UDP能做什么" class="headerlink" title="UDP能做什么"></a>UDP能做什么</h4><ul>
<li>DNS(访问网站DNS解析)、TFTP(文件传输的协议)、SNMP(网络数据协议传输中的监控的协议)</li>
<li>视频,音频(本身比较大,主要是用于直播),普通数据(无关紧要的数据) (下载视频音频还是要用TCP)</li>
<li>UDP的最大长度 16位2字节 就是2的16次方-1 然后自身协议占用32+32位=64位=8字节,所以最大长度为2的16次方-8-1字节.</li>
</ul>
<h4 id="UDP核心API"><a href="#UDP核心API" class="headerlink" title="UDP核心API"></a>UDP核心API</h4><ul>
<li>DatagramSocket <ul>
<li>用于接收与发送UDP的类</li>
<li>负责发送某一个UDP包或者接受UDP包</li>
<li>不同于TCP,UDP并没有合并到Socket API中</li>
<li>因为在UDP中是没有服务器和客户端的概念的,这个DatagramSocket 既是你的服务器,又是你的客户端,可以发送也可以接收,不用去监听某个客户端,不涉及客户端跟他的连接,不像TCP去监听一个TCP的来源,连接再进行通讯.</li>
<li>DatagramSocket() 构造函数 创建简单实例，不指定端口与IP,如果需要发送,那么会复用本地可用的端口进行发送数据</li>
<li>DatagramSocket(int port)创建监听固定端口的实例 可以指定某个端口进行监听,但是发送不是这个端口.</li>
<li>DatagramSocket(int port, InetAddress localAddr)创建固定端口指定IP的实例</li>
<li>receive(DatagramPacket d)∶接收</li>
<li>send(DatagramPacket d)∶发送</li>
<li>setSoTimeout(int timeout):设置超时，毫秒</li>
<li>close();关闭</li>
</ul>
</li>
<li>DatagramPacket<ul>
<li>用于处理报文</li>
<li>将byte数组、目标地址、目标端口等数据包装成报文或者将报文拆卸成byte数组</li>
<li>是UDP的发送实体,也是接收实体.</li>
<li>DatagramPacket(byte[] buf, int offset, int length, InetAddressaddress, int port)<ul>
<li>前三个参数指定buf的使用区间</li>
<li>后两个参数指定目标机器地址与端口</li>
</ul>
</li>
<li>setData(byte[] buf, int offset, int length),setData(byte[] buf),setData(int length)</li>
<li>getData(),getOffset(),getLength()</li>
</ul>
</li>
</ul>
<h4 id="UDP单播-广播-多播"><a href="#UDP单播-广播-多播" class="headerlink" title="UDP单播,广播,多播"></a>UDP单播,广播,多播</h4><p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210715232631856.png" alt="image-20210715232631856"></p>
<ul>
<li>广播地址: <ul>
<li>255.255.255.255为受限广播地址</li>
<li>C网广播地址一般为xxx.xxx.xxx.255</li>
<li>D类地址为多播预留</li>
<li>…..</li>
</ul>
</li>
</ul>
<h3 id="UDP案例-局域网搜索案例"><a href="#UDP案例-局域网搜索案例" class="headerlink" title="UDP案例-局域网搜索案例"></a>UDP案例-局域网搜索案例</h3><ul>
<li>UDP接受消息并回送功能实现.</li>
<li>UDP局域网广播发送实现.</li>
<li>UDP局域网回送消息实现.</li>
</ul>
<h4 id="UDP发送与监听小案例"><a href="#UDP发送与监听小案例" class="headerlink" title="UDP发送与监听小案例"></a>UDP发送与监听小案例</h4><p>服务提供者:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvider</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDP服务正在开启!&quot;</span>);</span><br><span class="line">        <span class="comment">//作为接收者(socket中的服务器),指定一个端口用于数据接收</span></span><br><span class="line">        DatagramSocket ds = <span class="keyword">new</span> DatagramSocket(<span class="number">20000</span>);</span><br><span class="line">        <span class="comment">//构建接受实体</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        DatagramPacket dp = <span class="keyword">new</span> DatagramPacket(bytes, bytes.length);</span><br><span class="line">        <span class="comment">//接收传过来的信息</span></span><br><span class="line">        ds.receive(dp);</span><br><span class="line">        <span class="comment">//打印发送者的信息</span></span><br><span class="line">        <span class="comment">//ip地址</span></span><br><span class="line">        String ip = dp.getAddress().getHostAddress();</span><br><span class="line">        <span class="comment">//端口号</span></span><br><span class="line">        <span class="keyword">int</span> prot = dp.getPort();</span><br><span class="line">        <span class="comment">//数据长度</span></span><br><span class="line">        <span class="keyword">int</span> dataLen = dp.getLength();</span><br><span class="line">        <span class="comment">//数据信息</span></span><br><span class="line">        String data = <span class="keyword">new</span> String(dp.getData(), <span class="number">0</span>, dataLen);</span><br><span class="line">        System.out.println(<span class="string">&quot;发送者的地址端口号 : &quot;</span> + ip</span><br><span class="line">                + <span class="string">&quot; : &quot;</span> + prot + <span class="string">&quot;;信息为 : &quot;</span> + data);</span><br><span class="line">        <span class="comment">//构建一份回送数据</span></span><br><span class="line">        String responseData = <span class="string">&quot;接收方已经接收到了!&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] responseBytes = responseData.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">//直接根据发送者构建一份回送信息</span></span><br><span class="line">        DatagramPacket responsePacket = <span class="keyword">new</span> DatagramPacket(responseBytes, responseBytes.length</span><br><span class="line">                , dp.getAddress(), dp.getPort());</span><br><span class="line"></span><br><span class="line">        ds.send(responsePacket);</span><br><span class="line">        System.out.println(<span class="string">&quot;UDP提供者服务已经完成!&quot;</span>);</span><br><span class="line">        ds.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>搜索方:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearcher</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDP搜索服务正在开启!&quot;</span>);</span><br><span class="line">        <span class="comment">//搜索方(TCP的客户端),无需提供端口,让系统自己分配端口</span></span><br><span class="line">        DatagramSocket ds = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="comment">//先准备发送数据过去</span></span><br><span class="line">        <span class="comment">//构建一份请求数据</span></span><br><span class="line">        String requestData = <span class="string">&quot;发送方发送数据了!&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] requestBytes = requestData.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">//直接构建packet</span></span><br><span class="line">        DatagramPacket requestPacket = <span class="keyword">new</span> DatagramPacket(requestBytes, requestBytes.length);</span><br><span class="line">        requestPacket.setAddress(InetAddress.getLocalHost());</span><br><span class="line">        requestPacket.setPort(<span class="number">20000</span>);</span><br><span class="line">        ds.send(requestPacket);</span><br><span class="line">        <span class="comment">//构建接受实体</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        DatagramPacket dp = <span class="keyword">new</span> DatagramPacket(bytes, bytes.length);</span><br><span class="line">        <span class="comment">//接收传过来的信息</span></span><br><span class="line">        ds.receive(dp);</span><br><span class="line">        <span class="comment">//打印发送者的信息</span></span><br><span class="line">        <span class="comment">//ip地址</span></span><br><span class="line">        String ip = dp.getAddress().getHostAddress();</span><br><span class="line">        <span class="comment">//端口号</span></span><br><span class="line">        <span class="keyword">int</span> prot = dp.getPort();</span><br><span class="line">        <span class="comment">//数据长度</span></span><br><span class="line">        <span class="keyword">int</span> dataLen = dp.getLength();</span><br><span class="line">        <span class="comment">//数据信息</span></span><br><span class="line">        String data = <span class="keyword">new</span> String(dp.getData(), <span class="number">0</span>, dataLen);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务的地址端口号 : &quot;</span> + ip</span><br><span class="line">                + <span class="string">&quot; : &quot;</span> + prot + <span class="string">&quot;;信息为 : &quot;</span> + data);</span><br><span class="line">        System.out.println(<span class="string">&quot;UDP搜索已经完成!&quot;</span>);</span><br><span class="line">        ds.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要是实现广播局域网搜索的功能,需要具备的功能和知识点:</p>
<p>服务提供者:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPProvider</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String sn = UUID.randomUUID().toString();</span><br><span class="line">        Provider provider = <span class="keyword">new</span> Provider(sn);</span><br><span class="line">        provider.start();</span><br><span class="line">        <span class="comment">//默认从键盘上输入则认为关闭</span></span><br><span class="line">        System.in.read();</span><br><span class="line">        provider.exit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String sn;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done;</span><br><span class="line">        <span class="keyword">private</span> DatagramSocket ds = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Provider</span><span class="params">(String sn)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;UDP服务正在开启!&quot;</span>);</span><br><span class="line">                <span class="comment">//作为接收者(socket中的服务器),指定一个端口用于数据接收</span></span><br><span class="line">                ds = <span class="keyword">new</span> DatagramSocket(<span class="number">20000</span>);</span><br><span class="line">                <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">                    <span class="comment">//构建接受实体</span></span><br><span class="line">                    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    DatagramPacket dp = <span class="keyword">new</span> DatagramPacket(bytes, bytes.length);</span><br><span class="line">                    <span class="comment">//接收传过来的信息</span></span><br><span class="line">                    ds.receive(dp);</span><br><span class="line">                    <span class="comment">//打印发送者的信息</span></span><br><span class="line">                    String ip = dp.getAddress().getHostAddress();</span><br><span class="line">                    <span class="keyword">int</span> prot = dp.getPort();</span><br><span class="line">                    <span class="keyword">int</span> dataLen = dp.getLength();</span><br><span class="line">                    <span class="comment">//数据信息</span></span><br><span class="line">                    String data = <span class="keyword">new</span> String(dp.getData(), <span class="number">0</span>, dataLen);</span><br><span class="line">                    System.out.println(<span class="string">&quot;发送者的地址端口号 : &quot;</span> + ip + <span class="string">&quot; : &quot;</span> + prot + <span class="string">&quot;;信息为 : &quot;</span> + data);</span><br><span class="line">                    <span class="keyword">int</span> responsePort = MessageCreator.parsePort(data);</span><br><span class="line">                    <span class="keyword">if</span> (responsePort != -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">//构建一份回送数据</span></span><br><span class="line">                        String responseData = MessageCreator.buildWithSn(sn);</span><br><span class="line">                        <span class="keyword">byte</span>[] responseBytes = responseData.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">                        <span class="comment">//直接根据发送者构建一份回送信息</span></span><br><span class="line">                        DatagramPacket responsePacket = <span class="keyword">new</span> DatagramPacket(responseBytes, responseBytes.length</span><br><span class="line">                                , dp.getAddress(), responsePort);</span><br><span class="line"></span><br><span class="line">                        ds.send(responsePacket);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;提供者异常退出!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                close();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;UDP提供者服务已经完成!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (ds != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ds.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">exit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">            close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>exist原理: 本身done=true并不能使服务停止,当启动服务后,将在<code>receive</code>进行阻塞,exit方法调用 ds.close,使得ds关闭,然后造成异常然后退出服务的</p>
<p>搜索者:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSearcher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LISTEN_PORT = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Listener listener=listen();</span><br><span class="line">        sendBroadcast();</span><br><span class="line">        System.in.read();</span><br><span class="line">        List&lt;Device&gt; devices= listener.getDeviceAndClose();</span><br><span class="line">        devices.forEach(d-&gt; System.out.println(<span class="string">&quot;Device -&gt; &quot;</span> +devices.toString()));</span><br><span class="line">        System.out.println(<span class="string">&quot;搜索已经完成!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Listener <span class="title">listen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始监听!&quot;</span>);</span><br><span class="line">        CountDownLatch countDownLatch=<span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        Listener listener=<span class="keyword">new</span> Listener(LISTEN_PORT,countDownLatch);</span><br><span class="line">        listener.start();</span><br><span class="line">        <span class="keyword">return</span> listener;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendBroadcast</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UDP搜索服务正在开启!&quot;</span>);</span><br><span class="line">        <span class="comment">//搜索方,无需提供端口,让系统自己分配端口</span></span><br><span class="line">        DatagramSocket ds = <span class="keyword">new</span> DatagramSocket();</span><br><span class="line">        <span class="comment">//构建一份请求数据</span></span><br><span class="line">        String requestData = MessageCreator.buildWithPort(LISTEN_PORT);</span><br><span class="line">        <span class="keyword">byte</span>[] requestBytes = requestData.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">//直接构建packet</span></span><br><span class="line">        DatagramPacket requestPacket = <span class="keyword">new</span> DatagramPacket(requestBytes, requestBytes.length);</span><br><span class="line">        <span class="comment">//20000端口 ,广播地址255.255.255.255</span></span><br><span class="line">        requestPacket.setAddress(InetAddress.getByName(<span class="string">&quot;255.255.255.255&quot;</span>));</span><br><span class="line">        requestPacket.setPort(<span class="number">20000</span>);</span><br><span class="line">        ds.send(requestPacket);</span><br><span class="line">        ds.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Device</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line">        <span class="keyword">final</span> String ip;</span><br><span class="line">        <span class="keyword">final</span> String sn;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Device</span><span class="params">(<span class="keyword">int</span> port, String ip, String sn)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.port = port;</span><br><span class="line">            <span class="keyword">this</span>.ip = ip;</span><br><span class="line">            <span class="keyword">this</span>.sn = sn;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Device&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;port=&quot;</span> + port +</span><br><span class="line">                    <span class="string">&quot;, ip=&#x27;&quot;</span> + ip + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, sn=&#x27;&quot;</span> + sn + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Listener</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> listenPort;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CountDownLatch countDownLatch;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Device&gt; devices = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">private</span> DatagramSocket ds = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Listener</span><span class="params">(<span class="keyword">int</span> listenPort, CountDownLatch countDownLatch)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.listenPort = listenPort;</span><br><span class="line">            <span class="keyword">this</span>.countDownLatch = countDownLatch;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">//通知已启用</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ds=<span class="keyword">new</span> DatagramSocket(listenPort);</span><br><span class="line">                <span class="keyword">while</span> (!done)&#123;</span><br><span class="line">                    <span class="comment">//构建接受实体</span></span><br><span class="line">                    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">                    DatagramPacket dp = <span class="keyword">new</span> DatagramPacket(bytes, bytes.length);</span><br><span class="line">                    <span class="comment">//接收传过来的信息</span></span><br><span class="line">                    ds.receive(dp);</span><br><span class="line">                    String ip = dp.getAddress().getHostAddress();</span><br><span class="line">                    <span class="keyword">int</span> prot = dp.getPort();</span><br><span class="line">                    <span class="keyword">int</span> dataLen = dp.getLength();</span><br><span class="line">                    String data = <span class="keyword">new</span> String(dp.getData(), <span class="number">0</span>, dataLen);</span><br><span class="line">                    System.out.println(<span class="string">&quot;服务的地址端口号 : &quot;</span> + ip</span><br><span class="line">                            + <span class="string">&quot; : &quot;</span> + prot + <span class="string">&quot;;信息为 : &quot;</span> + data);</span><br><span class="line">                    String sn= MessageCreator.parseSn(data);</span><br><span class="line">                    <span class="keyword">if</span> (sn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        Device device=<span class="keyword">new</span> Device(prot,ip,sn);</span><br><span class="line">                        devices.add(device);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;异常!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                close();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;监听结束!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (ds != <span class="keyword">null</span>) ds.close();</span><br><span class="line">            ds = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> List&lt;Device&gt; <span class="title">getDeviceAndClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.done = <span class="keyword">true</span>;</span><br><span class="line">            close();</span><br><span class="line">            <span class="keyword">return</span> devices;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>工具类:做一个简单的port和sn的封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageCreator</span> </span>&#123;</span><br><span class="line">    <span class="comment">//接收者的口令</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SN_HEADER = <span class="string">&quot;收到暗号,我是SN : &quot;</span>;</span><br><span class="line">    <span class="comment">//发送者的口令</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PORT_HEADER = <span class="string">&quot;这是发送者的暗号,请回端口(PORT):&quot;</span>;</span><br><span class="line">    <span class="comment">//发送暗号的端口号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">buildWithPort</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PORT_HEADER+port;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//解析端口号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parsePort</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.startsWith(PORT_HEADER))&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(data.substring(PORT_HEADER.length())); &#125;</span><br><span class="line">        <span class="keyword">return</span>  -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//sn与上面一致</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> String <span class="title">buildWithSn</span><span class="params">(String sn)</span></span>&#123; <span class="keyword">return</span> SN_HEADER+sn; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  String <span class="title">parseSn</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.startsWith(SN_HEADER)) <span class="keyword">return</span> data.substring(SN_HEADER.length());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Socket-TCP快速入门"><a href="#Socket-TCP快速入门" class="headerlink" title="Socket-TCP快速入门"></a>Socket-TCP快速入门</h3><h4 id="TCP是什么"><a href="#TCP是什么" class="headerlink" title="TCP是什么"></a>TCP是什么</h4><ul>
<li>TCP是传输控制协议;是一种面向连接的,可靠的,基于字节流的传输层通信协议.</li>
<li>与UDP一样完成第四层传输层所指定的功能与职责</li>
<li>TCP的机制<ul>
<li>三次握手,四次挥手</li>
<li>具有校验机制,可靠,数据传输的稳定性</li>
</ul>
</li>
</ul>
<h4 id="TCP链接-传输流程"><a href="#TCP链接-传输流程" class="headerlink" title="TCP链接,传输流程"></a>TCP链接,传输流程</h4><ul>
<li>客户端连接经过三次握手连接到服务器端</li>
<li>服务器端经过三次握手连接成功之后才会进入到后续的传输</li>
<li>后续两端就会发送属于与回送数据.</li>
<li>TCP数据发送中会有一些额外的数据进行发送,如果发送为100K,发送完了之后会有大于100K是正常的,两端之间会不断的进行数据校验等</li>
</ul>
<p><img src="/2021/07/14/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%88%9D%E5%A7%8B/image-20210718215504449.png" alt="image-20210718215504449"></p>
<h4 id="TCP能做什么"><a href="#TCP能做什么" class="headerlink" title="TCP能做什么"></a>TCP能做什么</h4><ul>
<li>聊天消息传输,推送</li>
<li>单人语音,视频聊天</li>
<li>几乎UDP能做的都能做,但是需要考虑复杂性,性能问题</li>
<li>限制: 无法进行广播,多播.</li>
</ul>
<h4 id="TCP核心API讲解"><a href="#TCP核心API讲解" class="headerlink" title="TCP核心API讲解"></a>TCP核心API讲解</h4><ul>
<li>socket(): 创建一个Socket(客户端)<ul>
<li>serverSock() 服务器端,监听来自客户端的套接字.</li>
</ul>
</li>
<li>bind(): 绑定一个Socket到一个本地地址和端口上</li>
<li>connect():连接到远程套接字</li>
<li>accept():服务器端独有的方法,接受一个新的连接,当serverSocket调用此方法,服务器端会进入阻塞状态,直到有客户端连接进来.默认时间无限长.</li>
<li>write(): 把数据写入到Socket输出流中</li>
<li>read(): 从Socket输如流读取数据.</li>
</ul>
<h3 id="TCP连接可靠性"><a href="#TCP连接可靠性" class="headerlink" title="TCP连接可靠性"></a>TCP连接可靠性</h3><h4 id="连接可靠性–三次握手"><a href="#连接可靠性–三次握手" class="headerlink" title="连接可靠性–三次握手"></a>连接可靠性–三次握手</h4><p>​    </p>
<h4 id="随机值的必要性"><a href="#随机值的必要性" class="headerlink" title="随机值的必要性"></a>随机值的必要性</h4><h4 id="连接可靠性–四次挥手"><a href="#连接可靠性–四次挥手" class="headerlink" title="连接可靠性–四次挥手"></a>连接可靠性–四次挥手</h4>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 学习</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/07/08/JavaIO%E6%B5%81%E5%88%9D%E5%A7%8B/" rel="prev" title="JavaIO流初始">
      <i class="fa fa-chevron-left"></i> JavaIO流初始
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/19/TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/" rel="next" title="TCP连接的三次握手和四次挥手">
      TCP连接的三次握手和四次挥手 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cw</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共19.8k字</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  















  

  

</body>
</html>
